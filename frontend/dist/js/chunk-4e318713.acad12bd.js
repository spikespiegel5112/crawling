(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e318713"],{"12b1":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"app-container"},[a("CommonQuery",[a("template",{slot:"button1"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:e.handleMultipleDelete}},[e._v(" 批量删除 ")])],1),a("template",{slot:"query1"},[a("div",{staticClass:"common_search_wrapper",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search.apply(null,arguments)}}},[a("label",[a("input",{directives:[{name:"model",rawName:"v-model",value:e.queryModel.brandName,expression:"queryModel.brandName"}],attrs:{placeholder:"请输入游戏名称",type:"text"},domProps:{value:e.queryModel.brandName},on:{input:function(t){t.target.composing||e.$set(e.queryModel,"brandName",t.target.value)}}})]),a("a",[a("span",{staticClass:"el-icon-search",on:{click:e.search}})])])])],2),a("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:e.tableList,height:e.tableHeight,border:"","element-loading-text":"Loading",fit:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{fixed:"left",type:"selection",width:"30"}}),a("el-table-column",{attrs:{align:"center",fixed:"",label:"No",type:"index",width:"45"}}),a("el-table-column",{attrs:{align:"center",label:"movieId",prop:"movieId",width:"110"}}),a("el-table-column",{attrs:{align:"center",label:"电影名称（中文）",prop:"titleChi",width:"150"}}),a("el-table-column",{attrs:{align:"center",label:"抓取时间",prop:"timestamp",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$moment(Number(t.row.timestamp)).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"上映时间",prop:"releaseDate"}}),a("el-table-column",{attrs:{align:"center",label:"预售票房",prop:"premiereBoxInfo"}}),a("el-table-column",{attrs:{align:"center",label:"预售排片占比",prop:"premiereShowRate"}}),a("el-table-column",{attrs:{align:"center",label:"预售排片场次",prop:"premiereShowRate"}}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.checkRecord(t)}}},[e._v("查看")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"common_pagination_wrapper"},[a("el-pagination",{attrs:{"current-page":e.pagination.page,"page-size":e.pagination.limit,"page-sizes":[10,20,30,50,100],total:e.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(t){return e.$set(e.pagination,"page",t)},"update:current-page":function(t){return e.$set(e.pagination,"page",t)},"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.checkPreSaleFlag,width:"1200px"},on:{"update:visible":function(t){e.checkPreSaleFlag=t}}},[a("el-row",{attrs:{justify:"center",type:"flex"}},[a("el-col",{attrs:{span:24}},[a("el-table",{attrs:{data:e.currentPreSaleDetailsTableData,border:"",fit:"","highlight-current-row":""},on:{"selection-change":e.checkPreSaleFlag}},[a("el-table-column",{attrs:{fixed:"left",type:"selection",width:"30"}}),a("el-table-column",{attrs:{align:"center",fixed:"",label:"No",type:"index",width:"45"}}),a("el-table-column",{attrs:{align:"center",label:"时间戳",prop:"timestamp",width:"130"}}),a("el-table-column",{attrs:{align:"center",label:"名称（中文）",prop:"titleChi",width:"110"}}),a("el-table-column",{attrs:{align:"center",label:"爬取日期",prop:"date",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$moment(Number(t.row.timestamp)).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"记录日期",prop:"bookingDate",width:"110"}}),a("el-table-column",{attrs:{align:"center",label:"累计首日预售",prop:"accumulatedFirstDayPreSale",width:"110"}}),a("el-table-column",{attrs:{align:"center",label:"当日新增预售",prop:"dailyAdditionalPreSale",width:"110"}}),a("el-table-column",{attrs:{align:"center",label:"累计开放场次",prop:"accumulatedOpenVenues"}}),a("el-table-column",{attrs:{align:"center",label:"当日新增场次",prop:"dailyAdditionalVenues"}}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],on:{click:function(t){e.checkPreSaleFlag=!1}}},[e._v("关闭")])],1)],1),a("el-dialog",{attrs:{visible:e.prepareToCrawlFlag,title:"准备爬取",width:"600px"},on:{"update:visible":function(t){e.prepareToCrawlFlag=t}}},[a("el-radio-group",{on:{change:e.handleChangeLimitType},model:{value:e.crawlerCountType,callback:function(t){e.crawlerCountType=t},expression:"crawlerCountType"}},[a("el-radio",{attrs:{label:0}},[e._v("全部")]),a("el-radio",{attrs:{label:1}},[e._v("部分")]),a("el-input-number",{attrs:{disabled:0===e.crawlerCountType,min:0},on:{change:e.handleChangeCountLimit},model:{value:e.preSaleListCountLimit,callback:function(t){e.preSaleListCountLimit=t},expression:"preSaleListCountLimit"}})],1),a("el-button",{attrs:{type:"primary"},on:{click:e.getAllCrawlingIndex}},[e._v("开始抓取列表")])],1)],1)},r=[],n=a("1da1"),l=(a("d3b7"),a("a4d3"),a("e01a"),a("99af"),a("25f0"),a("d81d"),a("4de4"),a("159b"),a("b0c0"),a("3ca3"),a("ddb0"),a("96cf"),a("3b8a")),o={components:{CommonQuery:l["a"]},data:function(){var e=this;return{getListByPaginationRequest:"crawlerMaoyanPreSale/getListByPagination",crawlAndSaveRequest:"crawlerMaoyanPreSale/crawlAndSave",crawlMoviePreSaleDetailRequest:"crawlerMaoyanPreSale/crawlMoviePreSaleDetail",crawlPreSaleWantToSeePortraitRequest:"crawlerMaoyanPreSale/crawlPreSaleWantToSeePortrait",crawlPreSaleBoxOfficePremiereRequest:"crawlerMaoyanPreSale/crawlPreSaleBoxOfficePremiere",deleteRecordRequest:"crawlerMaoyanPreSale/deleteRecords",getPreSaleBookingDetailsByMovieIdRequest:"crawlerMaoyanPreSale/getPreSaleBookingDetailsByMovieId",getSettingsRequest:"settings/getList",crawlMovieListRequest:"crawlerMaoyanPreSale/crawlMovieList",saveMultipleMaoyanPreSaleRequest:"crawlerMaoyanPreSale/saveMultipleMaoyanPreSale",crawlerSettingFlag:!1,crawlerSetting:{address:""},chosenReward:"",chooseRewardTypeModel:{},chosenThirdPartyProductInfo:{},value2:"",value1:"",dailyLimitMode:"",limitMode:"",tableKey:0,tableList:[],total:null,listLoading:!0,availabilityFlag:!1,statusDictionary:[{code:0,name:"未上线"},{code:1,name:"上线"}],queryModel:{sort:"desc",brandName:""},pagination:{page:1,limit:100},importanceOptions:[1,2,3],sortOptions:[{label:"ID Ascending",key:"+id"},{label:"ID Descending",key:"-id"}],statusOptions:["published","draft","deleted"],showReviewer:!1,formData:{headerCode:"maoyan",crawlerAddress:""},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"Edit",create:"Create"},dialogPvVisible:!1,rules:{id:[{required:!0,message:"此项为必填项",trigger:"change"}],description:[{required:!0,message:"此项为必填项",trigger:"change"}],name:[{required:!0,message:"此项为必填项",trigger:"change"}],dailyLimit:[{required:!0,message:"此项为必填项",trigger:"change"}],limit:[{required:!0,message:"此项为必填项",trigger:"change"}],startDate:[{required:!0,message:"此项为必填项",trigger:"change"}],endDate:[{required:!0,message:"此项为必填项",trigger:"change"}],status:[{required:!0,message:"此项为必填项",trigger:"change"}]},downloadLoading:!1,pickerOptions0:{disabledDate:function(t){if(""!==e.value2)return t.getTime()>e.value2}},pickerOptions1:{disabledDate:function(t){return t.getTime()<e.value1}},fileList:[],portraitParams:{bucketName:"funyvalley",folderName:"icon"},iosVersionListData:[],androidVersionListData:[],searchTxt:"",expandQuery:"",showFileListFlag:!1,newFile:"",crawlerCountType:0,advertisementDialogFlag:!1,currentAdvertisementTabIndex:0,effectiveDuration:[],multipleSelection:[],checkPreSaleFlag:!1,stepCrawlFlag:!1,prepareToCrawlFlag:!1,settingsList:[],preSaleData:[],crawlingCount:0,preSaleListData:[],crawlingFlag:!1,preSaleListCountLimit:0,currentPreSaleDetailsTableData:[]}},computed:{tableHeight:function(){return this.$store.state.app.tableHeight},dictionaryList:function(){return this.$store.state.app.dictionary.crawlerAddress},crawlerStyle:function(){return{height:this.tableHeight-180+"px",overflow:"auto"}}},watch:{effectiveDuration:function(e){console.log(e),null===e&&(e=[]),this.formData.startDate=this.$moment(e[0]).format("YYYY-MM-DD"),this.formData.endDate=this.$moment(e[1]).format("YYYY-MM-DD")},currentAdvertisementTabIndex:function(e){console.log(e)}},mounted:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getTableData();case 1:case"end":return t.stop()}}),t)})))()},methods:{getTableData:function(){var e=this;this.listLoading=!0,this.queryModel=Object.assign(this.queryModel,this.pagination),this.$http.get(this.$baseUrl+this.getListByPaginationRequest,{params:this.queryModel}).then((function(t){console.log("getListByPaginationRequest",t),e.tableList=t.data,e.total=t.pagination.total,e.listLoading=!1}))},getSettingsDictionary:function(){var e=this;return new Promise((function(t,a){e.$http.get(e.$baseUrl+e.getSettingsRequest,{params:{type:"crawlerAddress"}}).then((function(e){t(e.data)})).catch((function(e){console.log(e),a(e)}))}))},handleFilter:function(){this.pagination.page=1,this.getTableData()},handleSizeChange:function(e){this.pagination.limit=e,this.getTableData()},handleCurrentChange:function(e){this.pagination.page=e,this.getTableData()},resetTemp:function(){this.formData={id:"",description:"",rewardImage:"",rewardName:"",rewardPrompt:"",rewardStr:"",rewardType:"",rewardValue:"",status:"....."}},crawlerData:function(){var e=this;this.$http.post(this.$baseUrl+this.crawlAndSaveRequest,{address:this.formData.crawlerAddress,headerCode:this.formData.headerCode}).then((function(t){console.log(t),e.$message.success("抓取成功"),e.getTableData(),e.checkPreSaleFlag=!1}))},createData:function(){this.formData.id="",this.updateData()},handleUpdate:function(e){var t=this;console.log(e),this.formData=Object.assign({},e.row),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs["formData"].clearValidate()}))},updateData:function(){var e=this;this.$refs["formData"].validate((function(t){t&&e.$http.post(e.$baseUrl+e.addAndUpdateRewardInfoRequest,{id:e.formData.id,description:e.formData.description,rewardImage:e.formData.rewardImage,rewardName:e.formData.rewardName,rewardPrompt:e.formData.rewardPrompt,rewardStr:e.formData.rewardStr,rewardType:e.formData.rewardType,rewardValue:e.formData.rewardValue,status:e.formData.status}).then((function(t){console.log(t),e.dialogFormVisible=!1,e.$message.success("信息修改成功"),e.getTableData()})).catch((function(t){console.log(t),e.$message.error("".concat(t.response.status.toString(),"  ").concat(t.response.data.error))}))}))},handleSelectionChange:function(e){this.multipleSelection=e,console.log(e)},handleMultipleDelete:function(){var e=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.deleteRecord(e.multipleSelection.map((function(e){return e.id})))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},handleDelete:function(e){var t=this;console.log(e),this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteRecord([e.row.id])})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},deleteRecord:function(e){var t=this;this.$http.delete(this.$baseUrl+this.deleteRecordRequest,{data:{id:e}}).then((function(e){console.log(e),t.dialogFormVisible=!1,t.$message.success("删除成功"),t.getTableData()})).catch((function(e){console.log(e),t.$message.error("".concat(e.response.status.toString(),"  ").concat(e.response.data.error))}))},expand:function(){this.expandQuery=!this.expandQuery},search:function(){this.getTableData()},reset:function(){this.queryModel.available=!0},uploadSuccess1:function(e){console.log(e),this.formData.icon=e.url},uploadSuccess2:function(e){this.formData.rewardImage=e.url},changeDailyLimitMode:function(e){this.formData.dailyLimit="unlimited"===e.toString()?"-1":this.formData.dailyLimit},changeLimitMode:function(e){this.formData.limit="unlimited"===e.toString()?"-1":this.formData.limit,alert(this.formData.limit)},chooseRewardType:function(e){this.formData.type=this.settingsList.filter((function(t){return t.value===e}))[0].code,this.formData.crawlerAddress=e},chooseThirdPartyProduct:function(e){this.chosenThirdPartyProductInfo=e},confirmCrawlerSetting:function(){this.crawlerSettingFlag=!1,this.$message.success("设置成功")},focusSortList:function(e,t){var a=this;this.loading=!0,this.$http.get(this.$baseUrl+this.queryRewardProductByNameRequest,{params:{name:this.chosenReward}}).then((function(e){console.log(e),a.loading=!1;var i=[];0!==e.data.length&&(e.data.forEach((function(e,t){i.push(Object.assign(e,{value:e.name}))})),console.log(111,i),t(i))}))},getAllCrawlingIndex:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.prepareToCrawlFlag=!1,e.$http.get(e.$baseUrl+e.crawlMovieListRequest,{params:{address:"https://piaofang.maoyan.com/store",headerCode:"maoyanPreSale",limit:e.preSaleListCountLimit}}).then((function(t){console.log(t),e.preSaleListCountLimit=t.data.length,e.preSaleListData=t.data,e.preSaleListData.forEach((function(t,a){a<e.preSaleListCountLimit&&e.$set(e.preSaleListData,a,Object.assign(t,{detailSuccess:0,portraitSuccess:0,premiereSuccess:0,content:"detailSuccessportraitSuccess",color:"sunccess",recordTime:"---",active:!0}))})),e.$message.success("获取列表成功")})).catch((function(t){e.$message.error(t)}));case 2:case"end":return t.stop()}}),t)})))()},beginToCrawPreSaleListMovieData:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.crawlingCount=0,e.preSaleData=[],a=e.preSaleListData.filter((function(e){return e.active})),[],i={},!1,!1,r=function t(){var r=e.crawlingCount;e.crawlingFlag=!0;var n=a[r].movieId,l=function(){return new Promise((function(t,l){e.$http.get(e.$baseUrl+e.crawlPreSaleBoxOfficePremiereRequest,{params:{address:"https://piaofang.maoyan.com/movie/"+n+"/premierebox",headerCode:"maoyanPreSalePortrait"}}).then((function(n){i.portrait=n.data,e.$set(e.preSaleListData,r,Object.assign(a[r],{premiereSuccess:1,color:"success"})),t(n.data)})).catch((function(t){e.$set(e.preSaleListData,r,Object.assign(a[r],{premiereSuccess:2,color:"failed"})),l(t)}))}))},o=l();e.crawlingCount===e.preSaleListCountLimit?e.crawlingFlag=!1:e.crawlingCount++,Promise.all([o]).then((function(a){console.log(a),e.$set(e.preSaleData,r,Object.assign({movieId:n},a[0],a[1],a[2])),console.log("preSaleData",e.preSaleData),e.crawlingFlag&&(e.preSaleListData[r].recordTime=e.$moment(Date.now()).format("hh:mm:ss"),t())})).catch((function(a){console.log(a),e.crawlingCount===e.preSaleListCountLimit?e.crawlingFlag=!1:e.crawlingCount++,e.crawlingFlag&&t()}))},r();case 9:case"end":return t.stop()}}),t)})))()},stopCrawling:function(){this.crawlingFlag=!1},save:function(){var e=this;this.crawlingCount===this.preSaleListCountLimit?(console.log(this.preSaleData),this.$http.post(this.$baseUrl+this.saveMultipleMaoyanPreSaleRequest,this.preSaleData).then((function(t){e.$message.success("数据提交成功"),e.getTableData(),e.stepCrawlFlag=!1}))):this.$message.warning("dsdsdsdsds")},handleChangeLimitType:function(e){console.log(this.crawlerCountType),0===this.crawlerCountType&&(this.preSaleListCountLimit=0)},handleChangeCountLimit:function(){},handleChangeCounter:function(e){var t=this;this.preSaleListData.forEach((function(e,a){t.$set(t.preSaleListData,a,Object.assign(t.preSaleListData[a],{active:a<t.preSaleListCountLimit}))})),console.log("this.preSaleListData+++",this.preSaleListData)},checkRecord:function(e){var t=this;this.checkPreSaleFlag=!0,console.log(e),this.$http.get(this.$baseUrl+this.getPreSaleBookingDetailsByMovieIdRequest,{params:{movieId:e.row.movieId}}).then((function(e){console.log(e),t.currentPreSaleDetailsTableData=e.data})).catch((function(e){console.log(response)}))}}},s=o,c=(a("c911"),a("2877")),u=Object(c["a"])(s,i,r,!1,null,null,null);t["default"]=u.exports},c911:function(e,t,a){"use strict";a("d686")},d686:function(e,t,a){}}]);
//# sourceMappingURL=chunk-4e318713.acad12bd.js.map