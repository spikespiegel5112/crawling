(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2def0921"],{de50:function(e,t,a){"use strict";a("e717")},e717:function(e,t,a){},ec28:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"app-container"},[a("CommonQuery",[a("template",{slot:"button1"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{icon:"el-icon-plus",size:"mini",type:"primary"},on:{click:function(t){e.stepCrawlFlag=!0}}},[e._v(" 分步抓取 ")]),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:e.handleMultipleDelete}},[e._v(" 批量删除 ")])],1),a("template",{slot:"query1"},[a("div",{staticClass:"common_search_wrapper",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search.apply(null,arguments)}}},[a("label",[a("input",{directives:[{name:"model",rawName:"v-model",value:e.queryModel.brandName,expression:"queryModel.brandName"}],attrs:{placeholder:"请输入游戏名称",type:"text"},domProps:{value:e.queryModel.brandName},on:{input:function(t){t.target.composing||e.$set(e.queryModel,"brandName",t.target.value)}}})]),a("a",[a("span",{staticClass:"el-icon-search",on:{click:e.search}})])])])],2),a("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:e.tableList,height:e.tableHeight,border:"","element-loading-text":"Loading",fit:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{fixed:"left",type:"selection",width:"30"}}),a("el-table-column",{attrs:{align:"center",fixed:"",label:"No",type:"index",width:"45"}}),a("el-table-column",{attrs:{align:"center",label:"movieId",prop:"movieId",width:"100"}}),a("el-table-column",{attrs:{align:"center",label:"电影名称（中文）",prop:"titleChi",width:"100"}}),a("el-table-column",{attrs:{align:"center",label:"电影名称（原文）",prop:"title",width:"100"}}),a("el-table-column",{attrs:{align:"center",label:"抓取时间",prop:"timestamp",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$moment(Number(t.row.timestamp)).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"上映时间",prop:"releaseDate"}}),a("el-table-column",{attrs:{align:"center",label:"平台名称（英文）",prop:"platformEngName"}}),a("el-table-column",{attrs:{align:"center",label:"平台名称（中文）",prop:"platformChineseName"}}),a("el-table-column",{attrs:{align:"center",label:"平台类型",prop:"platformType"}}),a("el-table-column",{attrs:{align:"center",label:"想看数量",prop:"numWantToSee"}}),a("el-table-column",{attrs:{align:"center",label:"想看男性受众占比",prop:"wantToSeeByGenderMale"}}),a("el-table-column",{attrs:{align:"center",label:"想看女性受众占比",prop:"wantToSeeByGenderFemale"}}),a("el-table-column",{attrs:{align:"center",label:"想看20岁以下占比",prop:"wantToSeeByAge20"}}),a("el-table-column",{attrs:{align:"center",label:"想看20到24岁占比",prop:"wantToSeeByAge20To24"}}),a("el-table-column",{attrs:{align:"center",label:"想看25到29岁占比",prop:"wantToSeeByAge25To29"}}),a("el-table-column",{attrs:{align:"center",label:"想看30到34岁占比",prop:"wantToSeeByAge30To34"}}),a("el-table-column",{attrs:{align:"center",label:"想看35到39岁占比",prop:"wantToSeeByAge35To39"}}),a("el-table-column",{attrs:{align:"center",label:"想看40岁以上占比",prop:"wantToSeeByAge40"}}),a("el-table-column",{attrs:{align:"center",label:"想看一线城市占比",prop:"wantToSeeByTier1"}}),a("el-table-column",{attrs:{align:"center",label:"想看二线城市占比",prop:"wantToSeeByTier2"}}),a("el-table-column",{attrs:{align:"center",label:"想看三线城市占比",prop:"wantToSeeByTier3"}}),a("el-table-column",{attrs:{align:"center",label:"想看四线城市占比",prop:"wantToSeeByTier4"}}),a("el-table-column",{attrs:{align:"center",label:"预售票房",prop:"premiereBoxInfo"}}),a("el-table-column",{attrs:{align:"center",label:"预售排片占比",prop:"premiereShowRate"}}),a("el-table-column",{attrs:{align:"center",label:"预售排片场次",prop:"premiereShowRate"}}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"70px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"common_pagination_wrapper"},[a("el-pagination",{attrs:{"current-page":e.pagination.page,"page-size":e.pagination.limit,"page-sizes":[10,20,30,50,100],total:e.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(t){return e.$set(e.pagination,"page",t)},"update:current-page":function(t){return e.$set(e.pagination,"page",t)},"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.oneKeyCrawlFlag,width:"850px"},on:{"update:visible":function(t){e.oneKeyCrawlFlag=t}}},[a("el-row",{attrs:{justify:"center",type:"flex"}},[a("el-col",{attrs:{span:20}},[a("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rules,"label-position":"right","label-width":"140px"}},[a("el-form-item",{attrs:{label:"爬虫类型",prop:"rewardType"}},[a("el-select",{attrs:{placeholder:""},on:{change:e.chooseRewardType},model:{value:e.formData.rewardType,callback:function(t){e.$set(e.formData,"rewardType",t)},expression:"formData.rewardType"}},e._l(e.settingsList,(function(e){return a("el-option",{key:e.code,attrs:{label:e.name,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"爬虫地址",prop:"crawlerAddress"}},[a("el-input",{model:{value:e.formData.crawlerAddress,callback:function(t){e.$set(e.formData,"crawlerAddress",t)},expression:"formData.crawlerAddress"}})],1)],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],on:{click:function(t){e.oneKeyCrawlFlag=!1}}},[e._v(e._s(e.$t("table.cancel")))]),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary"},on:{click:e.crawlerData}},[e._v(e._s(e.$t("table.confirm")))])],1)],1),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.stepCrawlFlag,top:"1vh",width:"1600px"},on:{"update:visible":function(t){e.stepCrawlFlag=t}}},[a("el-row",{attrs:{gutter:1}},[a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.prepareToCrawlFlag=!0}}},[e._v(" "+e._s(0===e.preSaleListData.length?"获取索引":"重新获取索引")+" ")]),e.crawlingFlag?a("el-button",{attrs:{type:"danger"},on:{click:e.stopCrawling}},[e._v("停止抓取")]):a("el-button",{attrs:{disabled:0===e.preSaleListData.length,type:"primary"},on:{click:e.beginToCrawPreSaleListMovieData}},[e._v(" "+e._s(0===e.crawlingCount?"开始抓取":"重新抓取")+" ")])],1),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:20}},[a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)],1),a("el-divider"),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-row",{attrs:{justify:"left",type:"flex"}},[a("el-col",{attrs:{span:5}},[a("el-input-number",{attrs:{min:0},model:{value:e.preSaleListCountLimit,callback:function(t){e.preSaleListCountLimit=t},expression:"preSaleListCountLimit"}}),a("el-button",{attrs:{type:"primary"},on:{click:e.handleChangeCounter}},[e._v("确定")])],1),a("el-col",{attrs:{span:19}},[a("el-progress",{attrs:{percentage:0!==e.preSaleListData.length?Math.floor(e.crawlingCount/e.preSaleListData.filter((function(e){return e.active})).length*100):0,"stroke-width":20,"text-inside":!0,status:"success"}})],1)],1),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",{attrs:{shadow:"never"}},[a("el-divider",[a("el-row",[e.preSaleListData.length>0&&e.crawlingCount<e.preSaleListData.length?a("el-col",{attrs:{span:24}},[e._v(" 共有"+e._s(e.preSaleListData.length)+"条数据，正在抓取第"+e._s(e.crawlingCount)+"条... ")]):a("el-col",{attrs:{span:24}},[e._v(" 共有"+e._s(e.preSaleListData.length)+"条数据，抓取完毕 ")])],1)],1),a("el-row",{attrs:{justify:"left",type:"flex"}},[a("el-col",{attrs:{span:24}},[a("el-timeline",{style:e.crawlerStyle},e._l(e.preSaleListData.filter((function(e){return e.active})),(function(t,r){return a("el-timeline-item",{key:r,staticClass:"timelineitem",attrs:{color:"success"===t.color?"#91d929":"#e4e7ed",timestamp:t.recordTime,placement:"top"}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"text-align":"left"},attrs:{span:1}},[e._v("第"+e._s(r+1)+"条 ")]),a("el-col",{staticStyle:{"text-align":"left"},attrs:{span:4}},[e._v(e._s(t.title)+" ")]),a("el-col",{attrs:{span:2}},[e._v(" 详情: "),0===t.detailSuccess?a("i",{}):1===t.detailSuccess?a("i",{staticClass:"el-icon-check success"}):a("i",{staticClass:"el-icon-close failed"})]),a("el-col",{attrs:{span:2}},[e._v(" 想看画像: "),0===t.portraitSuccess?a("i",{}):1===t.portraitSuccess?a("i",{staticClass:"el-icon-check success"}):a("i",{staticClass:"el-icon-close failed"})]),a("el-col",{attrs:{span:2}},[e._v(" 预售票房: "),0===t.premiereSuccess?a("i",{}):1===t.premiereSuccess?a("i",{staticClass:"el-icon-check success"}):a("i",{staticClass:"el-icon-close failed"})]),a("el-col",{attrs:{span:2}},[e._v(" 预售票房明细: "),0===t.bookingDetailsSuccess?a("i",{}):1===t.bookingDetailsSuccess?a("i",{staticClass:"el-icon-check success"}):a("i",{staticClass:"el-icon-close failed"})])],1)],1)],1)})),1)],1)],1)],1)],1)],1)],1)],1),a("el-row",{attrs:{justify:"space-between",type:"flex"}},[a("el-col",{attrs:{span:21}}),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.stepCrawlFlag=!1}}},[e._v("关闭")])],1)],1)],1),a("el-dialog",{attrs:{visible:e.prepareToCrawlFlag,title:"准备爬取",width:"600px"},on:{"update:visible":function(t){e.prepareToCrawlFlag=t}}},[a("el-radio-group",{on:{change:e.handleChangeLimitType},model:{value:e.crawlerCountType,callback:function(t){e.crawlerCountType=t},expression:"crawlerCountType"}},[a("el-radio",{attrs:{label:0}},[e._v("全部")]),a("el-radio",{attrs:{label:1}},[e._v("部分")]),a("el-input-number",{attrs:{disabled:0===e.crawlerCountType,min:0},on:{change:e.handleChangeCountLimit},model:{value:e.preSaleListCountLimit,callback:function(t){e.preSaleListCountLimit=t},expression:"preSaleListCountLimit"}})],1),a("el-button",{attrs:{type:"primary"},on:{click:e.getAllCrawlingIndex}},[e._v("开始抓取列表")])],1)],1)},i=[],n=a("1da1"),l=(a("d3b7"),a("a4d3"),a("e01a"),a("99af"),a("25f0"),a("d81d"),a("4de4"),a("159b"),a("b0c0"),a("3ca3"),a("ddb0"),a("96cf"),a("3b8a")),s={components:{CommonQuery:l["a"]},data:function(){return{getListByPaginationRequest:"crawlerMaoyanPreSale/getListByPagination",crawlAndSaveRequest:"crawlerMaoyanPreSale/crawlAndSave",crawlPreSaleDetailRequest:"crawlerMaoyanPreSale/crawlPreSaleDetail",crawlPreSaleWantToSeePortraitRequest:"crawlerMaoyanPreSale/crawlPreSaleWantToSeePortrait",crawlPreSaleBoxOfficePremiereRequest:"crawlerMaoyanPreSale/crawlPreSaleBoxOfficePremiere",crawlPreSaleBookingDetailsRequest:"crawlerMaoyanPreSale/crawlPreSaleBookingDetails",deleteRecordRequest:"crawlerMaoyanPreSale/deleteRecords",getSettingsRequest:"settings/getList",crawlMovieListRequest:"crawlerMaoyanPreSale/crawlMovieList",saveMultipleMaoyanPreSaleRequest:"crawlerMaoyanPreSale/saveMultipleMaoyanPreSale",saveMultipleMaoyanPreSaleBookingDetailsRequest:"crawlerMaoyanPreSale/saveMultipleMaoyanPreSaleBookingDetails",crawlerSettingFlag:!1,crawlerSetting:{address:""},chosenReward:"",chooseRewardTypeModel:{},chosenThirdPartyProductInfo:{},value2:"",value1:"",dailyLimitMode:"",limitMode:"",tableKey:0,tableData:[{date:"2016-05-02",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄"},{date:"2016-05-04",name:"王小虎",address:"上海市普陀区金沙江路 1517 弄"},{date:"2016-05-01",name:"王小虎",address:"上海市普陀区金沙江路 1519 弄"},{date:"2016-05-03",name:"王小虎",address:"上海市普陀区金沙江路 1516 弄"}],tableList:[],total:null,listLoading:!0,availabilityFlag:!1,statusDictionary:[{code:0,name:"未上线"},{code:1,name:"上线"}],queryModel:{sort:"desc",brandName:""},pagination:{page:1,limit:100},importanceOptions:[1,2,3],sortOptions:[{label:"ID Ascending",key:"+id"},{label:"ID Descending",key:"-id"}],statusOptions:["published","draft","deleted"],showReviewer:!1,formData:{rewardType:"",crawlerAddress:""},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"Edit",create:"Create"},dialogPvVisible:!1,rules:{id:[{required:!0,message:"此项为必填项",trigger:"change"}],description:[{required:!0,message:"此项为必填项",trigger:"change"}],name:[{required:!0,message:"此项为必填项",trigger:"change"}],dailyLimit:[{required:!0,message:"此项为必填项",trigger:"change"}],limit:[{required:!0,message:"此项为必填项",trigger:"change"}],startDate:[{required:!0,message:"此项为必填项",trigger:"change"}],endDate:[{required:!0,message:"此项为必填项",trigger:"change"}],status:[{required:!0,message:"此项为必填项",trigger:"change"}]},fileList:[],searchTxt:"",expandQuery:"",crawlerCountType:0,currentAdvertisementTabIndex:0,effectiveDuration:[],multipleSelection:[],oneKeyCrawlFlag:!1,stepCrawlFlag:!1,prepareToCrawlFlag:!1,settingsList:[],preSaleData:[],crawlingCount:0,preSaleListData:[],bookingDetailsData:[],crawlingFlag:!1,preSaleListCountLimit:0}},computed:{tableHeight:function(){return this.$store.state.app.tableHeight},dictionaryList:function(){return this.$store.state.app.dictionary.crawlerAddress},crawlerStyle:function(){return{height:this.tableHeight-180+"px",overflow:"auto"}}},watch:{effectiveDuration:function(e){console.log(e),null===e&&(e=[]),this.formData.startDate=this.$moment(e[0]).format("YYYY-MM-DD"),this.formData.endDate=this.$moment(e[1]).format("YYYY-MM-DD")},currentAdvertisementTabIndex:function(e){console.log(e)}},mounted:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getTableData();case 1:case"end":return t.stop()}}),t)})))()},methods:{getTableData:function(){var e=this;this.listLoading=!0,this.queryModel=Object.assign(this.queryModel,this.pagination),this.$http.get(this.$baseUrl+this.getListByPaginationRequest,{params:this.queryModel}).then((function(t){console.log("getListByPaginationRequest",t),e.tableList=t.data,e.total=t.pagination.total,e.listLoading=!1}))},getSettingsDictionary:function(){var e=this;return new Promise((function(t,a){e.$http.get(e.$baseUrl+e.getSettingsRequest,{params:{type:"crawlerAddress"}}).then((function(e){t(e.data)})).catch((function(e){console.log(e),a(e)}))}))},handleFilter:function(){this.pagination.page=1,this.getTableData()},handleSizeChange:function(e){this.pagination.limit=e,this.getTableData()},handleCurrentChange:function(e){this.pagination.page=e,this.getTableData()},resetTemp:function(){this.formData={id:"",description:"",rewardImage:"",rewardName:"",rewardPrompt:"",rewardStr:"",rewardType:"",rewardValue:"",status:"....."}},crawlerData:function(){var e=this;this.$http.post(this.$baseUrl+this.crawlAndSaveRequest,{address:this.formData.crawlerAddress,headerCode:this.formData.headerCode}).then((function(t){console.log(t),e.$message.success("抓取成功"),e.getTableData(),e.oneKeyCrawlFlag=!1}))},createData:function(){this.formData.id="",this.updateData()},handleUpdate:function(e){var t=this;console.log(e),this.formData=Object.assign({},e.row),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs["formData"].clearValidate()}))},updateData:function(){var e=this;this.$refs["formData"].validate((function(t){t&&e.$http.post(e.$baseUrl+e.addAndUpdateRewardInfoRequest,{id:e.formData.id,description:e.formData.description,rewardImage:e.formData.rewardImage,rewardName:e.formData.rewardName,rewardPrompt:e.formData.rewardPrompt,rewardStr:e.formData.rewardStr,rewardType:e.formData.rewardType,rewardValue:e.formData.rewardValue,status:e.formData.status}).then((function(t){console.log(t),e.dialogFormVisible=!1,e.$message.success("信息修改成功"),e.getTableData()})).catch((function(t){console.log(t),e.$message.error("".concat(t.response.status.toString(),"  ").concat(t.response.data.error))}))}))},handleSelectionChange:function(e){this.multipleSelection=e,console.log(e)},handleMultipleDelete:function(){var e=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log("this.multipleSelection+++++",e.multipleSelection),e.deleteRecord(e.multipleSelection.map((function(e){return{id:e.id,movieId:e.movieId,timestamp:e.timestamp}})))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},handleDelete:function(e){var t=this;console.log(e),this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteRecord([e.row.movieId])})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},deleteRecord:function(e){var t=this;this.$http.delete(this.$baseUrl+this.deleteRecordRequest,{data:{selections:e}}).then((function(e){console.log(e),t.dialogFormVisible=!1,t.$message.success("删除成功"),t.getTableData()})).catch((function(e){console.log(e),t.$message.error("".concat(e.response.status.toString(),"  ").concat(e.response.data.error))}))},expand:function(){this.expandQuery=!this.expandQuery},search:function(){this.getTableData()},reset:function(){this.queryModel.available=!0},uploadSuccess1:function(e){console.log(e),this.formData.icon=e.url},uploadSuccess2:function(e){this.formData.rewardImage=e.url},changeDailyLimitMode:function(e){this.formData.dailyLimit="unlimited"===e.toString()?"-1":this.formData.dailyLimit},changeLimitMode:function(e){this.formData.limit="unlimited"===e.toString()?"-1":this.formData.limit,alert(this.formData.limit)},chooseRewardType:function(e){this.formData.type=this.settingsList.filter((function(t){return t.value===e}))[0].code,this.formData.crawlerAddress=e},chooseThirdPartyProduct:function(e){this.chosenThirdPartyProductInfo=e},confirmCrawlerSetting:function(){this.crawlerSettingFlag=!1,this.$message.success("设置成功")},focusSortList:function(e,t){var a=this;this.loading=!0,this.$http.get(this.$baseUrl+this.queryRewardProductByNameRequest,{params:{name:this.chosenReward}}).then((function(e){console.log(e),a.loading=!1;var r=[];0!==e.data.length&&(e.data.forEach((function(e,t){r.push(Object.assign(e,{value:e.name}))})),console.log(111,r),t(r))}))},getAllCrawlingIndex:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.prepareToCrawlFlag=!1,e.$http.get(e.$baseUrl+e.crawlMovieListRequest,{params:{address:"https://piaofang.maoyan.com/store",headerCode:"maoyanPreSale",limit:e.preSaleListCountLimit}}).then((function(t){console.log(t),e.preSaleListCountLimit=t.data.length,e.preSaleListData=t.data,e.preSaleListData.forEach((function(t,a){a<e.preSaleListCountLimit&&e.$set(e.preSaleListData,a,Object.assign(t,{detailSuccess:0,portraitSuccess:0,premiereSuccess:0,bookingDetailsSuccess:0,content:"detailSuccessportraitSuccess",color:"sunccess",recordTime:"---",active:!0}))})),e.$message.success("获取列表成功")})).catch((function(t){e.$message.error(t)}));case 2:case"end":return t.stop()}}),t)})))()},beginToCrawPreSaleListMovieData:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,r,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.crawlingCount=0,e.preSaleData=[],e.preSaleListData.forEach((function(t,a){e.$set(e.preSaleListData,a,Object.assign(t,{detailSuccess:0,portraitSuccess:0,premiereSuccess:0,bookingDetailsSuccess:0}))})),a=e.preSaleListData.filter((function(e){return e.active})),r={},i=Date.now(),n=function t(){var n=e.crawlingCount;e.crawlingFlag=!0;var l=a[n].movieId,s=function(){return new Promise((function(t,i){e.$http.get(e.$baseUrl+e.crawlPreSaleDetailRequest,{params:{address:"https://piaofang.maoyan.com/movie/"+l,headerCode:"maoyanPreSale"}}).then((function(i){r.detail=i.data,e.$set(e.preSaleListData,n,Object.assign(a[n],{detailSuccess:1})),t(i.data)})).catch((function(t){e.$set(e.preSaleListData,n,Object.assign(a[n],{detailSuccess:2})),i(t)}))}))},o=function(){return new Promise((function(t,i){e.$http.get(e.$baseUrl+e.crawlPreSaleWantToSeePortraitRequest,{params:{address:"https://piaofang.maoyan.com/movie/"+l,headerCode:"maoyanPreSalePortrait"}}).then((function(i){r.portrait=i.data,e.$set(e.preSaleListData,n,Object.assign(a[n],{portraitSuccess:1,color:"success"})),t(i.data)})).catch((function(t){e.$set(e.preSaleListData,n,Object.assign(a[n],{portraitSuccess:2,color:"failed"})),i(t)}))}))},c=function(){return new Promise((function(t,i){e.$http.get(e.$baseUrl+e.crawlPreSaleBoxOfficePremiereRequest,{params:{address:"https://piaofang.maoyan.com/movie/"+l+"/premierebox",headerCode:"maoyanPreSalePortrait"}}).then((function(i){r.portrait=i.data,e.$set(e.preSaleListData,n,Object.assign(a[n],{premiereSuccess:1,color:"success"})),t(i.data)})).catch((function(t){e.$set(e.preSaleListData,n,Object.assign(a[n],{premiereSuccess:2,color:"failed"})),i(t)}))}))},u=function(){return new Promise((function(t,i){e.$http.get(e.$baseUrl+e.crawlPreSaleBookingDetailsRequest,{params:{movieId:l,headerCode:"maoyanPreSalePortrait"}}).then((function(i){r.portrait=i.data,e.$set(e.preSaleListData,n,Object.assign(a[n],{bookingDetailsSuccess:1,color:"success"})),t(i.data)})).catch((function(t){e.$set(e.preSaleListData,n,Object.assign(a[n],{bookingDetailsSuccess:2,color:"failed"})),i(t)}))}))},p=s(),d=o(),g=c(),m=u();Promise.all([p,d,g,m]).then((function(a){console.log(a),e.$set(e.preSaleData,n,Object.assign({movieId:l,timestamp:i},a[0],a[1],a[2])),e.$set(e.bookingDetailsData,n,{movieId:l,timestamp:i,list:a[3].map((function(e){return Object.assign(e,{timestamp:i})}))}),e.crawlingCount++,e.crawlingCount===e.preSaleListCountLimit&&(e.crawlingFlag=!1),console.log("preSaleData",e.preSaleData),e.crawlingFlag&&(e.preSaleListData[n].recordTime=e.$moment(Date.now()).format("hh:mm:ss"),t())})).catch((function(a){console.log(a),e.crawlingCount===e.preSaleListCountLimit?e.crawlingFlag=!1:e.crawlingCount++,e.crawlingFlag&&t()}))},n();case 8:case"end":return t.stop()}}),t)})))()},stopCrawling:function(){this.crawlingFlag=!1},save:function(){var e=this;if(this.crawlingCount===this.preSaleListCountLimit){console.log("this.preSaleData+++++",this.preSaleData);var t=this.$http.post(this.$baseUrl+this.saveMultipleMaoyanPreSaleRequest,this.preSaleData),a=this.$http.post(this.$baseUrl+this.saveMultipleMaoyanPreSaleBookingDetailsRequest,this.bookingDetailsData);Promise.all([t,a]).then((function(t){e.getTableData(),e.stepCrawlFlag=!1,e.$message.success("数据提交成功")})).catch((function(t){e.$message.warning(t)}))}},handleChangeLimitType:function(e){console.log(this.crawlerCountType),0===this.crawlerCountType&&(this.preSaleListCountLimit=0)},handleChangeCountLimit:function(){},handleChangeCounter:function(e){var t=this;this.preSaleListData.forEach((function(e,a){t.$set(t.preSaleListData,a,Object.assign(t.preSaleListData[a],{active:a<t.preSaleListCountLimit}))})),console.log("this.preSaleListData+++",this.preSaleListData)}}},o=s,c=(a("de50"),a("2877")),u=Object(c["a"])(o,r,i,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-2def0921.306b3856.js.map